<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Cryptique du Jour (Multi-blocs)</title>
    
    <script src="enigme.js" defer></script>

    <style>
        /* --- MODIFICATION CSS --- */
        /* --- MODIFICATION CSS --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f4f7f6; /* Couleur de secours si l'image ne charge pas */
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 1.5rem;
            gap: 1.5rem;
            box-sizing: border-box;

            /* --- NOUVEAU : Image de fond --- */
            background-image: url('lettres.jpeg'); /* Chemin vers votre image */
            background-size: cover; /* L'image couvrira tout le fond sans répétition */
            background-position: center center; /* Centre l'image */
            background-attachment: fixed; /* L'image reste fixe lors du défilement */
            /* Optionnel : un léger filtre pour améliorer la lisibilité */
            /* backdrop-filter: brightness(0.9); */ 
        }
        
        /* --- BLOC 1 : Puzzle --- */
        .puzzle-container {
            /* background-color: #ffffff; <-- Ancien */

            /* NOUVEAU : Fond bois */
            background-color: #3a2e28; /* Secours si l'image ne charge pas */
            background-image: url('bois.jpeg');
            background-size: cover;
            background-position: center;

            /* TRÈS IMPORTANT : Texte clair */
            color: #f5f5f5;

            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.07);
            padding: 2rem 2.5rem;
            width: 100%;
            max-width: 600px;
            text-align: center;
            box-sizing: border-box; 
        }
        
        /* --- NOUVEAU : BLOC 2 : Indices --- */
        .hint-container {
            /* background-color: #ffffff; <-- Ancien */

            /* NOUVEAU : Fond bois */
            background-color: #3a2e28; /* Secours si l'image ne charge pas */
            background-image: url('bois.jpeg');
            background-size: cover;
            background-position: center;

            /* TRÈS IMPORTANT : Texte clair */
            color: #f5f5f5;

            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.07);
            padding: 2rem 2.5rem;
            width: 100%;
            max-width: 600px;
            box-sizing: border-box;
            text-align: left;
        }

        /* Le reste de vos styles (inchangés) */
        h1 {
                /* color: #2c3e50; <-- Ancien */
                color: #ffffff; /* NOUVEAU */
                margin-top: 0;
                margin-bottom: 1rem;
        }
        .date {
            font-size: 0.9rem;
            /* color: #888; <-- Ancien */
            color: #ccc; /* NOUVEAU (Gris clair) */
            margin-bottom: 2rem;
            border-bottom: 1px solid #555; /* Ligne de séparation plus visible */
            padding-bottom: 1.5rem;
        }
        .clue-box { background-color: #f9f9f9; border-left: 5px solid #3498db; padding: 1.5rem; text-align: left; margin-bottom: 1rem; border-radius: 0 8px 8px 0; }
        .clue-text { font-size: 1.3rem; font-weight: 500; line-height: 1.6; margin: 0; color:#000}
        .clue-text span { transition: background-color 0.3s ease; border-radius: 4px; }
        .clue-text span.highlight-definition { background-color: #a0eec0; font-weight: 600; }
        .clue-text span.highlight-source { background-color: #a0d0ee; }
        .clue-text span.highlight-indicator { background-color: #f0a0a0; font-style: italic; }
        .clue-length { font-size: 1.1rem; font-style: italic; color: #555; margin-top: 0.5rem; display: block; }

        .hint-title {
            font-size: 1rem;
            font-weight: 600;
            /* color: #555; <-- Ancien */
            color: #f5f5f5; /* NOUVEAU */
            margin-bottom: 0.5rem;
            text-align: left;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }        
        .hint-controls { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem; }
        .hint-button { font-size: 0.8rem; font-weight: 600; padding: 0.5rem 0.8rem; border: 2px solid #ddd; background-color: #fff; color: #555; border-radius: 20px; cursor: pointer; transition: all 0.2s; }
        .hint-button:hover { background-color: #f5f5f5; border-color: #ccc; }
        .hint-button.letter-hint { grid-column: 1 / -1; background-color: #fffaf0; border-color: #f0c040; color: #d09000; }
        .hint-button.letter-hint:hover { background-color: #fef5e0; }
        .hint-button:disabled { background-color: #f9f9f9; border-color: #eee; color: #ccc; cursor: not-allowed; opacity: 0.7; }
        .hint-button.active-definition { background-color: #a0eec0; border-color: #50c070; color: #000; }
        .hint-button.active-source { background-color: #a0d0ee; border-color: #50a0d0; color: #000; }
        .hint-button.active-indicator { background-color: #f0a0a0; border-color: #d05050; color: #000; }
        
        .hint-explanation-box { background-color: #fdfdfd; border: 1px dashed #ddd; border-radius: 8px; padding: 1rem; text-align: left; margin-bottom: 1.5rem; font-size: 0.9rem; line-height: 1.4; display: none; opacity: 0; transition: opacity 0.3s ease-out; }
        .hint-explanation-box.visible { display: block; opacity: 1; }

        .answer-grid { display: flex; justify-content: center; gap: 5px; margin-bottom: 1rem; }
        .letter-input { width: 45px; height: 45px; font-size: 1.8rem; font-weight: bold; text-align: center; text-transform: uppercase; border: 2px solid #ccc; border-radius: 5px; outline: none; transition: border-color 0.2s, background-color 0.2s; background-color: #fff; }
        .letter-input:focus { border-color: #3498db; box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2); }
        .letter-input.revealed { background-color: #e6f7ff; color: #3498db; border-color: #a0d0ee; }
        .letter-input.correct-final { border-color: #2ecc71; background-color: #e6ffe6; color: #2ecc71; }
        .letter-input.incorrect { border-color: #e74c3c; animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

        .submit-button { font-size: 1.1rem; font-weight: bold; color: #ffffff; background-color: #2ecc71; border: none; padding: 0.8rem 1.5rem; border-radius: 8px; cursor: pointer; transition: background-color 0.2s, transform 0.1s; width: 100%; }
        .submit-button:hover { background-color: #27ae60; }
        .submit-button:active { transform: scale(0.98); }
        .submit-button:disabled { background-color: #cccccc; cursor: not-allowed; }

        .explanation-section { background-color: #f0f8ff; border: 1px solid #cceeff; border-radius: 8px; padding: 1.5rem; text-align: left; margin-top: 1.5rem; opacity: 0; max-height: 0; overflow: hidden; transition: opacity 0.5s ease-out, max-height 0.7s ease-out; }
        .explanation-section.visible { opacity: 1; max-height: 500px; }
        .explanation-section h3 { color: #3498db; margin-top: 0; margin-bottom: 0.8rem; font-size: 1.1rem; }
        .explanation-section p { font-size: 1rem; line-height: 1.5; margin-bottom: 0; color:#000}
        
        .hint-count { font-size: 0.9rem; font-weight: 600; color: #555; background-color: #e0f0ff; padding: 0.5rem 1rem; border-radius: 6px; margin-top: 1rem; border: 1px solid #cceeff; }

    </style>
</head>

<body>

    <main class="puzzle-container">
        
        <h1>Le Cryptique du Jour</h1>
        <p class="date">Lundi 17 novembre 2025</p>

        <div class="clue-box">
            <p id="clueText" class="clue-text"></p>
            <span id="clueLength" class="clue-length"></span>
        </div>

        <div id="answerGrid" class="answer-grid">
            </div>

        <button id="submitButton" class="submit-button">Vérifier</button>
        
        <div id="explanationSection" class="explanation-section">
            <h3>Explication du Jour :</h3>
            <p id="explanationText"></p>
            <p id="hintCountText" class="hint-count"></p>
        </div>

    </main> <section class="hint-container">

        <h3 class="hint-title">Indices</h3>
        
        <div class="hint-controls">
            <button id="btn-definition" class="hint-button">Définition</button>
            <button id="btn-source" class="hint-button">Source</button>
            <button id="btn-indicator" class="hint-button">Indicateur</button>
            
            <button id="btn-letter" class="hint-button letter-hint">Indice Lettre</button>
        </div>
        
        <div id="hintExplanationBox" class="hint-explanation-box">
            Cliquez sur un indice pour voir l'explication.
        </div>

    </section> <script>
        window.addEventListener('load', () => {
            if (typeof puzzleDuJour === 'undefined') {
                console.error("ERREUR : 'enigme.js' n'a pas été chargé ou est vide.");
                document.getElementById('clueText').textContent = "Erreur : Impossible de charger l'énigme du jour.";
                return;
            }
            const clueTextElement = document.getElementById('clueText');
            const clueLengthElement = document.getElementById('clueLength');
            const answerGrid = document.getElementById('answerGrid'); 
            const submitButton = document.getElementById('submitButton');
            const explanationSection = document.getElementById('explanationSection');
            const explanationTextElement = document.getElementById('explanationText');
            const btnDefinition = document.getElementById('btn-definition');
            const btnSource = document.getElementById('btn-source');
            const btnIndicator = document.getElementById('btn-indicator');
            const hintExplanationBox = document.getElementById('hintExplanationBox');
            const btnLetter = document.getElementById('btn-letter');
            const hintCountText = document.getElementById('hintCountText');
            let currentActiveHint = null;
            let mainHintsUsed = new Set(); 
            let letterHintsUsed = 0;       
            let letterInputs = [];
            function initializeGame() {
                clueTextElement.innerHTML = '';
                puzzleDuJour.clueStructure.forEach(segment => {
                    const span = document.createElement('span');
                    span.textContent = segment.text;
                    span.dataset.type = segment.type; 
                    clueTextElement.appendChild(span);
                });
                clueLengthElement.textContent = puzzleDuJour.clueLength;
                explanationTextElement.textContent = puzzleDuJour.finalExplanation;
                answerGrid.innerHTML = '';
                letterInputs = [];
                for (let i = 0; i < puzzleDuJour.correctAnswser.length; i++) {
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.maxLength = 1; 
                    input.classList.add('letter-input');
                    input.dataset.index = i; 
                    input.addEventListener('input', handleLetterInput);
                    input.addEventListener('keydown', handleLetterKeydown);
                    answerGrid.appendChild(input);
                    letterInputs.push(input);
                }
                letterInputs.forEach(input => {
                    input.value = '';
                    input.readOnly = false;
                    input.classList.remove('correct-final', 'revealed');
                });
                submitButton.disabled = false;
                btnLetter.disabled = false; 
                submitButton.textContent = 'Vérifier';
                explanationSection.classList.remove('visible');
                hintCountText.textContent = ''; 
                mainHintsUsed.clear(); 
                letterHintsUsed = 0;
                resetHints();
                if (letterInputs.length > 0) {
                    letterInputs[0].focus();
                }
            }
            function handleLetterInput(event) {
                const input = event.target;
                let value = input.value.toUpperCase();
                if (value.length > 0 && !/^[A-Z]$/.test(value)) {
                    input.value = '';
                    return;
                }
                input.value = value; 
                if (value.length === 1) {
                    const currentIndex = parseInt(input.dataset.index);
                    for (let nextIndex = currentIndex + 1; nextIndex < letterInputs.length; nextIndex++) {
                        if (letterInputs[nextIndex].value === '') {
                            letterInputs[nextIndex].focus();
                            break;
                        }
                    }
                }
                if (letterInputs.every(input => input.value.length === 1)) {
                    checkAnswer();
                }
            }
            function handleLetterKeydown(event) {
                const input = event.target;
                const index = parseInt(input.dataset.index);
                if (event.key === 'Backspace') {
                    if (input.value === '' && index > 0) {
                        letterInputs[index - 1].focus();
                    }
                }
                else if (event.key === 'ArrowLeft' && index > 0) {
                    letterInputs[index - 1].focus();
                }
                else if (event.key === 'ArrowRight' && index < letterInputs.length - 1) {
                    letterInputs[index + 1].focus();
                }
            }
            btnDefinition.addEventListener('click', () => toggleHint('definition'));
            btnSource.addEventListener('click', () => toggleHint('source'));
            btnIndicator.addEventListener('click', () => toggleHint('indicator'));
            btnLetter.addEventListener('click', revealLetter);
            submitButton.addEventListener('click', checkAnswer);
            function toggleHint(type) {
                if (currentActiveHint === type) { resetHints(); return; }
                resetHints(); 
                currentActiveHint = type;
                mainHintsUsed.add(type);
                hintExplanationBox.textContent = puzzleDuJour.hintExplanations[type];
                hintExplanationBox.classList.add('visible');
                clueTextElement.querySelectorAll('span').forEach(span => {
                    if (span.dataset.type === type) {
                        span.classList.add(`highlight-${type}`);
                    }
                });
                document.getElementById(`btn-${type}`).classList.add(`active-${type}`);
            }
            function revealLetter() {
                resetHints();
                const correctAnswer = puzzleDuJour.correctAnswser;
                const emptyIndexes = [];
                for (let i = 0; i < letterInputs.length; i++) {
                    if (letterInputs[i].value === '') {
                        emptyIndexes.push(i);
                    }
                }
                if (emptyIndexes.length === 0) {
                    btnLetter.disabled = true;
                    return;
                }
                letterHintsUsed++;
                const randomChoice = Math.floor(Math.random() * emptyIndexes.length);
                const randomIndexToReveal = emptyIndexes[randomChoice];
                const letterToReveal = correctAnswer[randomIndexToReveal];
                letterInputs[randomIndexToReveal].value = letterToReveal;
                letterInputs[randomIndexToReveal].classList.add('revealed'); 
                if (emptyIndexes.length === 1) {
                     btnLetter.disabled = true;
                }
            }
            function resetHints() {
                currentActiveHint = null;
                hintExplanationBox.classList.remove('visible');
                hintExplanationBox.textContent = "Cliquez sur un indice pour voir l'explication.";
                clueTextElement.querySelectorAll('span').forEach(span => {
                    span.classList.remove('highlight-definition', 'highlight-source', 'highlight-indicator');
                });
                [btnDefinition, btnSource, btnIndicator].forEach(btn => {
                    btn.classList.remove('active-definition', 'active-source', 'active-indicator');
                });
            }
            function checkAnswer() {
                const userAnswer = letterInputs.map(input => input.value).join('').toUpperCase();
                letterInputs.forEach(input => input.classList.remove('incorrect'));
                if (userAnswer === puzzleDuJour.correctAnswser) {
                    letterInputs.forEach(input => {
                        input.value = input.value.toUpperCase(); 
                        input.classList.add('correct-final');
                        input.readOnly = true; 
                    });
                    submitButton.disabled = true;
                    btnLetter.disabled = true; 
                    submitButton.textContent = 'Correct !';
                    explanationSection.classList.add('visible');
                    const mainHintCount = mainHintsUsed.size;
                    const totalHints = mainHintCount + letterHintsUsed;
                    let countMessage = `Indices utilisés : ${totalHints}`;
                    if (totalHints > 0) {
                        countMessage += ` (${mainHintCount} aide(s) et ${letterHintsUsed} lettre(s))`;
                    }
                    hintCountText.textContent = countMessage;
                    resetHints(); 
                } else {
                    letterInputs.forEach(input => {
                        input.classList.add('incorrect');
                        input.addEventListener('animationend', () => {
                            input.classList.remove('incorrect');
                        }, { once: true });
                    });
                }
            }
            initializeGame();
        });
    </script>

</body>
</html>
